const searchBtn = document.getElementById("searchBtn");
const searchInput = document.getElementById("searchInput");
const infoDiv = document.getElementById("info");
const imagesDiv = document.getElementById("images");

searchBtn.addEventListener("click", () => {
  const query = searchInput.value.trim();
  if (query) {
    getInfo(query);
    getImages(query);
  }
});

async function getInfo(query) {
  infoDiv.innerHTML = "<p>‚è≥ Ma'lumot yuklanmoqda...</p>";

  try {
    // Avval uz.wikipedia dan qidirish
    let response = await fetch(`https://uz.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(query)}`);
    let data = await response.json();

    // Agar topilmasa inglizcha Wikipedia dan
    if (!data.extract) {
      response = await fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(query)}`);
      data = await response.json();
    }

    if (data.extract) {
      infoDiv.innerHTML = `
        <h2>${data.title}</h2>
        <p>${data.extract}</p>
        ${data.thumbnail ? `<img src="${data.thumbnail.source}" alt="${data.title}" style="width:100%;border-radius:10px;margin-top:10px;">` : ""}
      `;
    } else {
      infoDiv.innerHTML = "<p>‚ùå Ma'lumot topilmadi. Boshqa so‚Äòz bilan urinib ko‚Äòring.</p>";
    }
  } catch (error) {
    infoDiv.innerHTML = "<p>‚ö†Ô∏è Ma'lumot olishda xatolik yuz berdi.</p>";
  }
}

async function getImages(query) {
  imagesDiv.innerHTML = "<p>üì∏ Rasmlar yuklanmoqda...</p>";
  try {
    const response = await fetch(`https://images-api.nasa.gov/search?q=${encodeURIComponent(query)}&media_type=image`);
    const data = await response.json();
    const items = data.collection.items.slice(0, 8);

    if (items.length > 0) {
      imagesDiv.innerHTML = items
        .map(item => `<img src="${item.links[0].href}" alt="${query}">`)
        .join("");
    } else {
      imagesDiv.innerHTML = "<p>üì∑ Rasm topilmadi.</p>";
    }
  } catch (error) {
    imagesDiv.innerHTML = "<p>‚ö†Ô∏è Rasmlarni olishda xatolik yuz berdi.</p>";
  }
}
